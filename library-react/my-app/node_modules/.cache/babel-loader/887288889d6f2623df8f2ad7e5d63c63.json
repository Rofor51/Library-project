{"ast":null,"code":"/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\n/* eslint-disable complexity */\n\n/* eslint-disable max-statements */\nrequire('./vendor/polyfills');\n\nvar Q = require('q');\n\nvar oauthUtil = require('./oauthUtil');\n\nvar util = require('./util');\n\nvar tx = require('./tx');\n\nvar session = require('./session');\n\nvar cookies = require('./cookies');\n\nvar token = require('./token');\n\nvar AuthSdkError = require('./errors/AuthSdkError');\n\nvar config = require('./config');\n\nvar TokenManager = require('./TokenManager');\n\nvar http = require('./http');\n\nfunction OktaAuthBuilder(args) {\n  var sdk = this;\n\n  if (!args) {\n    throw new AuthSdkError('No arguments passed to constructor. ' + 'Required usage: new OktaAuth(args)');\n  }\n\n  if (!args.url) {\n    throw new AuthSdkError('No url passed to constructor. ' + 'Required usage: new OktaAuth({url: \"https://sample.okta.com\"})');\n  }\n\n  if (args.url.indexOf('-admin.') !== -1) {\n    throw new AuthSdkError('URL passed to constructor contains \"-admin\" in subdomain. ' + 'Required usage: new OktaAuth({url: \"https://dev-12345.okta.com})');\n  }\n\n  this.options = {\n    url: util.removeTrailingSlash(args.url),\n    clientId: args.clientId,\n    issuer: util.removeTrailingSlash(args.issuer),\n    authorizeUrl: util.removeTrailingSlash(args.authorizeUrl),\n    userinfoUrl: util.removeTrailingSlash(args.userinfoUrl),\n    redirectUri: args.redirectUri,\n    ajaxRequest: args.ajaxRequest,\n    transformErrorXHR: args.transformErrorXHR,\n    headers: args.headers\n  };\n  this.userAgent = 'okta-auth-js-' + config.SDK_VERSION; // Digital clocks will drift over time, so the server\n  // can misalign with the time reported by the browser.\n  // The maxClockSkew allows relaxing the time-based\n  // validation of tokens (in seconds, not milliseconds).\n  // It currently defaults to 300, because 5 min is the\n  // default maximum tolerance allowed by Kerberos.\n  // (https://technet.microsoft.com/en-us/library/cc976357.aspx)\n\n  if (!args.maxClockSkew && args.maxClockSkew !== 0) {\n    this.options.maxClockSkew = config.DEFAULT_MAX_CLOCK_SKEW;\n  } else {\n    this.options.maxClockSkew = args.maxClockSkew;\n  }\n\n  sdk.session = {\n    close: util.bind(session.closeSession, null, sdk),\n    exists: util.bind(session.sessionExists, null, sdk),\n    get: util.bind(session.getSession, null, sdk),\n    refresh: util.bind(session.refreshSession, null, sdk),\n    setCookieAndRedirect: util.bind(session.setCookieAndRedirect, null, sdk)\n  };\n  sdk.tx = {\n    status: util.bind(tx.transactionStatus, null, sdk),\n    resume: util.bind(tx.resumeTransaction, null, sdk),\n    exists: util.bind(tx.transactionExists, null, sdk)\n  }; // This is exposed so we can mock document.cookie in our tests\n\n  sdk.tx.exists._getCookie = function (name) {\n    return cookies.getCookie(name);\n  };\n\n  sdk.idToken = {\n    authorize: util.deprecateWrap('Use token.getWithoutPrompt, token.getWithPopup, or token.getWithRedirect ' + 'instead of idToken.authorize.', util.bind(token.getToken, null, sdk)),\n    verify: util.deprecateWrap('Use token.verify instead of idToken.verify', util.bind(token.verifyIdToken, null, sdk)),\n    refresh: util.deprecateWrap('Use token.refresh instead of idToken.refresh', util.bind(token.refreshIdToken, null, sdk)),\n    decode: util.deprecateWrap('Use token.decode instead of idToken.decode', token.decodeToken)\n  }; // This is exposed so we can mock window.location.href in our tests\n\n  sdk.idToken.authorize._getLocationHref = function () {\n    return window.location.href;\n  };\n\n  sdk.token = {\n    getWithoutPrompt: util.bind(token.getWithoutPrompt, null, sdk),\n    getWithPopup: util.bind(token.getWithPopup, null, sdk),\n    getWithRedirect: util.bind(token.getWithRedirect, null, sdk),\n    parseFromUrl: util.bind(token.parseFromUrl, null, sdk),\n    decode: token.decodeToken,\n    refresh: util.bind(token.refreshToken, null, sdk),\n    getUserInfo: util.bind(token.getUserInfo, null, sdk),\n    verify: util.bind(token.verifyToken, null, sdk)\n  }; // This is exposed so we can set window.location in our tests\n\n  sdk.token.getWithRedirect._setLocation = function (url) {\n    window.location = url;\n  }; // This is exposed so we can mock getting window.history in our tests\n\n\n  sdk.token.parseFromUrl._getHistory = function () {\n    return window.history;\n  }; // This is exposed so we can mock getting window.location in our tests\n\n\n  sdk.token.parseFromUrl._getLocation = function () {\n    return window.location;\n  }; // This is exposed so we can mock getting window.document in our tests\n\n\n  sdk.token.parseFromUrl._getDocument = function () {\n    return window.document;\n  };\n\n  sdk.fingerprint._getUserAgent = function () {\n    return navigator.userAgent;\n  };\n\n  var isWindowsPhone = /windows phone|iemobile|wpdesktop/i;\n\n  sdk.features.isFingerprintSupported = function () {\n    var agent = sdk.fingerprint._getUserAgent();\n\n    return agent && !isWindowsPhone.test(agent);\n  };\n\n  sdk.tokenManager = new TokenManager(sdk, args.tokenManager);\n}\n\nvar proto = OktaAuthBuilder.prototype;\nproto.features = {};\n\nproto.features.isPopupPostMessageSupported = function () {\n  var isIE8or9 = document.documentMode && document.documentMode < 10;\n\n  if (window.postMessage && !isIE8or9) {\n    return true;\n  }\n\n  return false;\n};\n\nproto.features.isTokenVerifySupported = function () {\n  return typeof crypto !== 'undefined' && crypto.subtle && typeof Uint8Array !== 'undefined';\n}; // { username, password, (relayState), (context) }\n\n\nproto.signIn = function (opts) {\n  var sdk = this;\n  opts = util.clone(opts || {});\n\n  function postToTransaction(options) {\n    delete opts.sendFingerprint;\n    return tx.postToTransaction(sdk, '/api/v1/authn', opts, options);\n  }\n\n  if (!opts.sendFingerprint) {\n    return postToTransaction();\n  }\n\n  return sdk.fingerprint().then(function (fingerprint) {\n    return postToTransaction({\n      headers: {\n        'X-Device-Fingerprint': fingerprint\n      }\n    });\n  });\n};\n\nproto.signOut = function () {\n  return this.session.close();\n}; // { username, (relayState) }\n\n\nproto.forgotPassword = function (opts) {\n  return tx.postToTransaction(this, '/api/v1/authn/recovery/password', opts);\n}; // { username, (relayState) }\n\n\nproto.unlockAccount = function (opts) {\n  return tx.postToTransaction(this, '/api/v1/authn/recovery/unlock', opts);\n}; // { recoveryToken }\n\n\nproto.verifyRecoveryToken = function (opts) {\n  return tx.postToTransaction(this, '/api/v1/authn/recovery/token', opts);\n}; // { resource, (rel), (requestContext)}\n\n\nproto.webfinger = function (opts) {\n  var url = '/.well-known/webfinger' + util.toQueryParams(opts);\n  var options = {\n    headers: {\n      'Accept': 'application/jrd+json'\n    }\n  };\n  return http.get(this, url, options);\n};\n\nproto.fingerprint = function (options) {\n  options = options || {};\n  var sdk = this;\n\n  if (!sdk.features.isFingerprintSupported()) {\n    return Q.reject(new AuthSdkError('Fingerprinting is not supported on this device'));\n  }\n\n  var deferred = Q.defer();\n  var iframe = document.createElement('iframe');\n  iframe.style.display = 'none';\n\n  function listener(e) {\n    if (!e || !e.data || e.origin !== sdk.options.url) {\n      return;\n    }\n\n    try {\n      var msg = JSON.parse(e.data);\n    } catch (err) {\n      return deferred.reject(new AuthSdkError('Unable to parse iframe response'));\n    }\n\n    if (!msg) {\n      return;\n    }\n\n    if (msg.type === 'FingerprintAvailable') {\n      return deferred.resolve(msg.fingerprint);\n    }\n\n    if (msg.type === 'FingerprintServiceReady') {\n      e.source.postMessage(JSON.stringify({\n        type: 'GetFingerprint'\n      }), e.origin);\n    }\n  }\n\n  oauthUtil.addListener(window, 'message', listener);\n  iframe.src = sdk.options.url + '/auth/services/devicefingerprint';\n  document.body.appendChild(iframe);\n  var timeout = setTimeout(function () {\n    deferred.reject(new AuthSdkError('Fingerprinting timed out'));\n  }, options.timeout || 15000);\n  return deferred.promise.fin(function () {\n    clearTimeout(timeout);\n    oauthUtil.removeListener(window, 'message', listener);\n\n    if (document.body.contains(iframe)) {\n      iframe.parentElement.removeChild(iframe);\n    }\n  });\n};\n\nmodule.exports = function (ajaxRequest) {\n  function OktaAuth(args) {\n    if (!(this instanceof OktaAuth)) {\n      return new OktaAuth(args);\n    }\n\n    if (args && !args.ajaxRequest) {\n      args.ajaxRequest = ajaxRequest;\n    }\n\n    util.bind(OktaAuthBuilder, this)(args);\n  }\n\n  OktaAuth.prototype = OktaAuthBuilder.prototype;\n  OktaAuth.prototype.constructor = OktaAuth;\n  return OktaAuth;\n};","map":{"version":3,"sources":["C:/Users/robin/Desktop/sso/my-app/node_modules/@okta/okta-signin-widget/node_modules/@okta/okta-auth-js/lib/clientBuilder.js"],"names":["require","Q","oauthUtil","util","tx","session","cookies","token","AuthSdkError","config","TokenManager","http","OktaAuthBuilder","args","sdk","url","indexOf","options","removeTrailingSlash","clientId","issuer","authorizeUrl","userinfoUrl","redirectUri","ajaxRequest","transformErrorXHR","headers","userAgent","SDK_VERSION","maxClockSkew","DEFAULT_MAX_CLOCK_SKEW","close","bind","closeSession","exists","sessionExists","get","getSession","refresh","refreshSession","setCookieAndRedirect","status","transactionStatus","resume","resumeTransaction","transactionExists","_getCookie","name","getCookie","idToken","authorize","deprecateWrap","getToken","verify","verifyIdToken","refreshIdToken","decode","decodeToken","_getLocationHref","window","location","href","getWithoutPrompt","getWithPopup","getWithRedirect","parseFromUrl","refreshToken","getUserInfo","verifyToken","_setLocation","_getHistory","history","_getLocation","_getDocument","document","fingerprint","_getUserAgent","navigator","isWindowsPhone","features","isFingerprintSupported","agent","test","tokenManager","proto","prototype","isPopupPostMessageSupported","isIE8or9","documentMode","postMessage","isTokenVerifySupported","crypto","subtle","Uint8Array","signIn","opts","clone","postToTransaction","sendFingerprint","then","signOut","forgotPassword","unlockAccount","verifyRecoveryToken","webfinger","toQueryParams","reject","deferred","defer","iframe","createElement","style","display","listener","e","data","origin","msg","JSON","parse","err","type","resolve","source","stringify","addListener","src","body","appendChild","timeout","setTimeout","promise","fin","clearTimeout","removeListener","contains","parentElement","removeChild","module","exports","OktaAuth","constructor"],"mappings":"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","sourcesContent":["/*!\n * Copyright (c) 2015-2016, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n/* eslint-disable complexity */\n/* eslint-disable max-statements */\n\nrequire('./vendor/polyfills');\n\nvar Q                 = require('q');\nvar oauthUtil         = require('./oauthUtil');\nvar util              = require('./util');\nvar tx                = require('./tx');\nvar session           = require('./session');\nvar cookies           = require('./cookies');\nvar token             = require('./token');\nvar AuthSdkError      = require('./errors/AuthSdkError');\nvar config            = require('./config');\nvar TokenManager      = require('./TokenManager');\nvar http              = require('./http');\n\nfunction OktaAuthBuilder(args) {\n  var sdk = this;\n\n  if (!args) {\n    throw new AuthSdkError('No arguments passed to constructor. ' +\n      'Required usage: new OktaAuth(args)');\n  }\n\n  if (!args.url) {\n    throw new AuthSdkError('No url passed to constructor. ' +\n      'Required usage: new OktaAuth({url: \"https://sample.okta.com\"})');\n  }\n\n  if (args.url.indexOf('-admin.') !== -1) {\n    throw new AuthSdkError('URL passed to constructor contains \"-admin\" in subdomain. ' +\n      'Required usage: new OktaAuth({url: \"https://dev-12345.okta.com})');\n  }\n\n  this.options = {\n    url: util.removeTrailingSlash(args.url),\n    clientId: args.clientId,\n    issuer: util.removeTrailingSlash(args.issuer),\n    authorizeUrl: util.removeTrailingSlash(args.authorizeUrl),\n    userinfoUrl: util.removeTrailingSlash(args.userinfoUrl),\n    redirectUri: args.redirectUri,\n    ajaxRequest: args.ajaxRequest,\n    transformErrorXHR: args.transformErrorXHR,\n    headers: args.headers\n  };\n\n  this.userAgent = 'okta-auth-js-' + config.SDK_VERSION;\n\n  // Digital clocks will drift over time, so the server\n  // can misalign with the time reported by the browser.\n  // The maxClockSkew allows relaxing the time-based\n  // validation of tokens (in seconds, not milliseconds).\n  // It currently defaults to 300, because 5 min is the\n  // default maximum tolerance allowed by Kerberos.\n  // (https://technet.microsoft.com/en-us/library/cc976357.aspx)\n  if (!args.maxClockSkew && args.maxClockSkew !== 0) {\n    this.options.maxClockSkew = config.DEFAULT_MAX_CLOCK_SKEW;\n  } else {\n    this.options.maxClockSkew = args.maxClockSkew;\n  }\n\n  sdk.session = {\n    close: util.bind(session.closeSession, null, sdk),\n    exists: util.bind(session.sessionExists, null, sdk),\n    get: util.bind(session.getSession, null, sdk),\n    refresh: util.bind(session.refreshSession, null, sdk),\n    setCookieAndRedirect: util.bind(session.setCookieAndRedirect, null, sdk)\n  };\n\n  sdk.tx = {\n    status: util.bind(tx.transactionStatus, null, sdk),\n    resume: util.bind(tx.resumeTransaction, null, sdk),\n    exists: util.bind(tx.transactionExists, null, sdk)\n  };\n\n  // This is exposed so we can mock document.cookie in our tests\n  sdk.tx.exists._getCookie = function(name) {\n    return cookies.getCookie(name);\n  };\n\n  sdk.idToken = {\n    authorize: util.deprecateWrap('Use token.getWithoutPrompt, token.getWithPopup, or token.getWithRedirect ' +\n      'instead of idToken.authorize.', util.bind(token.getToken, null, sdk)),\n    verify: util.deprecateWrap('Use token.verify instead of idToken.verify', util.bind(token.verifyIdToken, null, sdk)),\n    refresh: util.deprecateWrap('Use token.refresh instead of idToken.refresh',\n      util.bind(token.refreshIdToken, null, sdk)),\n    decode: util.deprecateWrap('Use token.decode instead of idToken.decode', token.decodeToken)\n  };\n\n  // This is exposed so we can mock window.location.href in our tests\n  sdk.idToken.authorize._getLocationHref = function() {\n    return window.location.href;\n  };\n\n  sdk.token = {\n    getWithoutPrompt: util.bind(token.getWithoutPrompt, null, sdk),\n    getWithPopup: util.bind(token.getWithPopup, null, sdk),\n    getWithRedirect: util.bind(token.getWithRedirect, null, sdk),\n    parseFromUrl: util.bind(token.parseFromUrl, null, sdk),\n    decode: token.decodeToken,\n    refresh: util.bind(token.refreshToken, null, sdk),\n    getUserInfo: util.bind(token.getUserInfo, null, sdk),\n    verify: util.bind(token.verifyToken, null, sdk)\n  };\n\n  // This is exposed so we can set window.location in our tests\n  sdk.token.getWithRedirect._setLocation = function(url) {\n    window.location = url;\n  };\n\n  // This is exposed so we can mock getting window.history in our tests\n  sdk.token.parseFromUrl._getHistory = function() {\n    return window.history;\n  };\n\n  // This is exposed so we can mock getting window.location in our tests\n  sdk.token.parseFromUrl._getLocation = function() {\n    return window.location;\n  };\n\n  // This is exposed so we can mock getting window.document in our tests\n  sdk.token.parseFromUrl._getDocument = function() {\n    return window.document;\n  };\n\n  sdk.fingerprint._getUserAgent = function() {\n    return navigator.userAgent;\n  };\n\n  var isWindowsPhone = /windows phone|iemobile|wpdesktop/i;\n  sdk.features.isFingerprintSupported = function() {\n    var agent = sdk.fingerprint._getUserAgent();\n    return agent && !isWindowsPhone.test(agent);\n  };\n\n  sdk.tokenManager = new TokenManager(sdk, args.tokenManager);\n}\n\nvar proto = OktaAuthBuilder.prototype;\n\nproto.features = {};\n\nproto.features.isPopupPostMessageSupported = function() {\n  var isIE8or9 = document.documentMode && document.documentMode < 10;\n  if (window.postMessage && !isIE8or9) {\n    return true;\n  }\n  return false;\n};\n\nproto.features.isTokenVerifySupported = function() {\n  return typeof crypto !== 'undefined' && crypto.subtle && typeof Uint8Array !== 'undefined';\n};\n\n// { username, password, (relayState), (context) }\nproto.signIn = function (opts) {\n  var sdk = this;\n  opts = util.clone(opts || {});\n  function postToTransaction(options) {\n    delete opts.sendFingerprint;\n    return tx.postToTransaction(sdk, '/api/v1/authn', opts, options);\n  }\n  if (!opts.sendFingerprint) {\n    return postToTransaction();\n  }\n  return sdk.fingerprint()\n  .then(function(fingerprint) {\n    return postToTransaction({\n      headers: {\n        'X-Device-Fingerprint': fingerprint\n      }\n    });\n  });\n};\n\nproto.signOut = function () {\n  return this.session.close();\n};\n\n// { username, (relayState) }\nproto.forgotPassword = function (opts) {\n  return tx.postToTransaction(this, '/api/v1/authn/recovery/password', opts);\n};\n\n// { username, (relayState) }\nproto.unlockAccount = function (opts) {\n  return tx.postToTransaction(this, '/api/v1/authn/recovery/unlock', opts);\n};\n\n// { recoveryToken }\nproto.verifyRecoveryToken = function (opts) {\n  return tx.postToTransaction(this, '/api/v1/authn/recovery/token', opts);\n};\n\n// { resource, (rel), (requestContext)}\nproto.webfinger = function (opts) {\n  var url = '/.well-known/webfinger' + util.toQueryParams(opts);\n  var options = {\n    headers: {\n      'Accept': 'application/jrd+json'\n    }\n  };\n  return http.get(this, url, options);\n};\n\nproto.fingerprint = function(options) {\n  options = options || {};\n  var sdk = this;\n  if (!sdk.features.isFingerprintSupported()) {\n    return Q.reject(new AuthSdkError('Fingerprinting is not supported on this device'));\n  }\n\n  var deferred = Q.defer();\n\n  var iframe = document.createElement('iframe');\n  iframe.style.display = 'none';\n\n  function listener(e) {\n    if (!e || !e.data || e.origin !== sdk.options.url) {\n      return;\n    }\n\n    try {\n      var msg = JSON.parse(e.data);\n    } catch (err) {\n      return deferred.reject(new AuthSdkError('Unable to parse iframe response'));\n    }\n\n    if (!msg) { return; }\n    if (msg.type === 'FingerprintAvailable') {\n      return deferred.resolve(msg.fingerprint);\n    }\n    if (msg.type === 'FingerprintServiceReady') {\n      e.source.postMessage(JSON.stringify({\n        type: 'GetFingerprint'\n      }), e.origin);\n    }\n  }\n  oauthUtil.addListener(window, 'message', listener);\n\n  iframe.src = sdk.options.url + '/auth/services/devicefingerprint';\n  document.body.appendChild(iframe);\n\n  var timeout = setTimeout(function() {\n    deferred.reject(new AuthSdkError('Fingerprinting timed out'));\n  }, options.timeout || 15000);\n\n  return deferred.promise.fin(function() {\n    clearTimeout(timeout);\n    oauthUtil.removeListener(window, 'message', listener);\n    if (document.body.contains(iframe)) {\n      iframe.parentElement.removeChild(iframe);\n    }\n  });\n};\n\nmodule.exports = function(ajaxRequest) {\n  function OktaAuth(args) {\n    if (!(this instanceof OktaAuth)) {\n      return new OktaAuth(args);\n    }\n\n    if (args && !args.ajaxRequest) {\n      args.ajaxRequest = ajaxRequest;\n    }\n    util.bind(OktaAuthBuilder, this)(args);\n  }\n  OktaAuth.prototype = OktaAuthBuilder.prototype;\n  OktaAuth.prototype.constructor = OktaAuth;\n\n  return OktaAuth;\n};\n"]},"metadata":{},"sourceType":"script"}